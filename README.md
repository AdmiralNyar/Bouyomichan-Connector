# BymChn Connector(β)
棒読みちゃんコネクター（BymChn Connector）は、Foundry VTT(ver 9)と棒読みちゃんとCoeFont[^1]を連携させるためのModです。このMod単体では動作せず、下記のツールのインストール（ダウンロード）や登録が必要になりますので、ご注意ください。（自分を含めた）全員のチャットに打ち込んで送信した文章が、自分の棒読みちゃんから（CoeFontの場合はFoundry VTTのページから）音声として出力されます。また、アクターおよびユーザーごとに読み上げさせる声を予め設定しておくこともできます。

## 注意
- このMODによって生じた**いかなる損害や損失に対して、MOD作成者である私は一切の責任と義務を負っていない**ことにご注意ください。
- チャットを利用した他のMODと干渉する場合があるので、ご注意ください。
- 合成音声の著作権を侵害しないように使用してください。
- このMODはβ版であり、バグが残っている可能性があります。もしバグを発見された場合には、ご一報くださいますとありがたいです。
- このMODを使用したTRPGプレイ動画等を投稿される場合は、このMODとFoundryVTTの紹介をしていただけますと、大変うれしく思います（ご協力お願いいたします）

## 使用方法
### 基本
1. このMODをインストールする
- 下記のリンクをFoundryVTT起動画面の「アドオン・モジュール」⇒「モジュールインストール」⇒「URLを指定：」⇒「インストール」からインストールしてください
[リンク]()
![インストール画面]()

2. 各ワールドのモジュールの管理より、「Bouyomichan Connector」を有効化してください
![MOD有効化]()

3. MODを有効化したワールドの画面左側の♫マーク内に吹き出しマークのボタンが追加されますので、有効化（紫色が明るくなった状態）してください
- シーンが1つ以上存在しないワールドでは左側のボタンは全て無効化されてますので、本当に初期のワールドはまずシーンを何でもいいので作成してください
![読み上げ切り替えスイッチオン]()

4. 棒読みちゃんをインストールする
![棒読みちゃんDL元]()

5. 棒読みちゃんWebSocketプラグインをインストール・棒読みちゃんで有効化する
![棒読みちゃんWebSocketプラグインDL元]()
![棒読みちゃんWebSocketプラグイン有効化]()

6. 棒読みちゃんをデスクトップ上で起動する

7. チャットにテキストを打ち込んで送信する
![棒読みちゃんデフォルト読み上げ]()

### ユーザーとアクターごとに声質を変更する
1. 基本編の「6.」の後、基本編の「3.」の♫マークの下に歯車マークのボタンが（追加されて）ありますので、クリックしてください
![個別読み上げ設定]()

2. 現在ユーザーとして登録されている名前とアクターの名前が一覧で出てきます
- ドロップダウンリストの中の声の選択肢を追加したい場合には、次の『SAPI5対応合成音声エンジンを追加する』、『CoeFontのボイスを追加する』を参照してください

3. デフォルトから声質を変更したトークンをシーンに配置し、トークンとして話してみましょう

### SAPI5対応合成音声エンジンを追加する
1. ワールドの「コンフィグ設定」⇒「モジュール設定」⇒「Bouyomichan Connector」⇒「SAPI5音声ID設定」から設定画面を表示させてください
![SAPI5対応合成エンジン追加]()

2. 棒読みちゃんの「基本設定」⇒「音声合成エンジン」から追加したい種別SAPI5のIDと名前を確認します

3. 「1.」で出した設定画面右上のプラスマークをクリックして行を追加してください

4. 追加した行に「2.」で確認した名前とIDを入力します
- ここで入力した名前は、『ユーザーとアクターごとに声質を変更する』で説明したドロップダウンリストでの表示名となりますので、略称等でも問題ありません（重要なのはIDです）

5. 「変更内容を保存」し、自分のユーザーの声質を変更してテストしてみましょう
- 「変更内容を保存」しなければ、内容は登録されないので注意ください（閉じるマークはダメ！）

### CoeFontのボイスを追加する
**まず、CoeFontは有料であり、ボイスを使用する度に課金して得たポイントを消費することにご注意ください(CoeFont APIを使用するので、ブラウザ上で基本無料のアリアル・ミリアル・アルベーニも1文字5ポイント消費します！)**
**CoeFontにはNGワードがあります。卑猥な用語、放送禁止用語等のNGワードを含む言葉はエラーとなり、出力されませんので注意お願いします（例：壇ノ浦に本当に行ったの？⇒裏日本、参考動画）**
1. CoeFontに登録する
![CoeFont登録]()

2. CoeFont画面右上のユーザーマーク（アカウント設定）からAPI情報を開き、アクセスキー（Access Key）とクライアントシークレット（Client Secret）を確認します
![CoeFontAPI情報]()

3. CoeFontとやりとりできるAPIを用意します（下記のリンクからWindows 10上で実行形式(exeファイル)で起動できるCoeFont API用ローカルサーバーアプリがあるので、問題なければそちらをお使いください）
- APIはPOSTで下記のデータをFoundryVTTから送られますので、返却用のjsonデータを返してください
- API側で、先ほど確認したアクセスキーとクライアントシークレットを使用します（詳しくは、CoeFont APIの仕様のページか、下記のリンク先を参照ください）
POST
```
Header : "Content-Type": "application/json"
```
```
{
    "text" : "読み上げる文章(string)",
    "coefont" : "音声変換を行うcoefontのID。coefont詳細画面のurlに表示される個別のuuidを参照。(string)",
    "volume" : [0.2 .. 2](float)
}
```
RESPONSE
```
{
    url : "CoeFont APIから得たwavファイルのURL(string)"
}
```

4. 用意したAPIを起動します

5. CoeFont上からFoundryVTTで使用したい音源のページを表示して、そのURLからuuid部分をコピーします
- https://coefont.cloud/coefonts/***** の ****の部分
![CoeFontのuuid]()

6. FoundryVTTのワールドの「コンフィグ設定」⇒「モジュール設定」⇒「Bouyomichan Connector」⇒「CoeFontとの連携機能を使用する」にチェックを入れ、「変更内容を保存」します
![CoeFont機能有効化]()

7. 再度「モジュール設定」を開くと、「Bouyomichan Connector」内に「CoeFontのボイスを登録」のボタンと「CoeFontAPIと接続する独自APIのURL」等が追加されています

8. 「CoeFontAPIと接続する独自APIのURL」には「4.」で起動したAPIのURLを張り付けます

9. 「CoeFontのボイスを登録」から設定画面を開き、CoeFontの名前とuuidを登録します
- 右側のΛマークをクリックすると、喜怒哀楽のuuidを別に登録できます
- 喜怒哀楽を使用したい場合は、発声者が該当のCoeFontのボイスに声質を変更した状態で、チャットの一番初めに喜なら「ki) 」、怒なら「do) 」、哀なら「ai) 」、楽なら「rk) 」を入力してチャットを送る（各括弧の次と読み上げたい文章との間に半角スペースがあることと、文字は全て半角小文字であることに注意すること）
- 既に登録してあるuuidを変更する場合は、ユーザー（アクター）で指定のCoeFontの声質に新しいuuidが反映されていないので、声質の変更から一度別の声に変更後その声質に戻してください
![CoeFontのuuid登録]()

10. 「変更内容を保存」し、自分のユーザーの声質を変更してテストしてみましょう
- 「変更内容を保存」しないと変更が反映されないので注意してください

### Theatre Insertsと併用する
1. 立ち絵MOD Theatre Insertsが有効となっているワールドであれば、ユーザーとアクターごとの声質の変更の設定画面に自動的に「ナレーター」が追加されます。Theater Insertsでナレーター用読み上げ音声を設定しておくことができます
![ナレーター読み上げ]()
![アクターセリフ]()

### 他のプレイヤーに読み上げ音声を聞かせる
1. VoiceMeeter Banana等の仮想ミキサーを使用して、通話アプリのマイクやFoundryVTTのWebRTC音声通話のマイクから合成音声を流しましょう
- [VoiceMeeter Banana](https://vb-audio.com/Voicemeeter/banana.htm)
- [使い方紹介外部記事](https://blog.isarver.com/howtovoicemeeter-ch-firstsetting/)

### VOICEROIDやAI.VOICEなど各合成音声を棒読みちゃんに追加する
1. VOICEROID2、VOICEROID+ EX版、VOICEROID+（東北ずん子、結月ゆかり、民安ともえ、鷹の爪 吉田くん）、VOICEROID（月読アイ、月読ショウタ）、ガイノイドTalk、音街ウナTalk Ex、ギャラ子Talk、かんたん! AITalk 3、かんたん! AITalk 3 関西風の場合
- [ここ](https://wangdora.rdy.jp/?plugin/VTP) からVoiceroid Talk Plusのプラグインをインストールして棒読みちゃんで有効にしてください
- この場合の声質は、チャットの話者の声質がCoeFontの声質以外の場合に上書き実行して使います（例えば、Player1が女性1（棒読みちゃん）設定時に、Voiceroid Talk Plusの設定内のコマンド一覧にある鷹の爪 吉田くんボイス（コマンド 「v)」）を話したい場合は、「v) "読み上げたい文章"」をチャットに入力してください）

2. VOICEVOXの場合
- [ここページ](https://github.com/shigobu/SAPIForVOICEVOX) から「SAPI For VOICEVOX」をダウンロードして棒読みちゃんとVOICEVOXと併用してください（SAPI5として追加されます）

3. A.I.Voiceの場合
- [ここのページ](https://github.com/gizagizamax/PotatoVoiceHub) から「PotatoVoiceHub」をダウンロードして棒読みちゃんとVoiceroid Talk Plusと連携してください

4. VOICEPEAKの場合（連携できません。棒読みちゃんと連携する方法をご存じの方がいましたら情報提供ください）

5. CeVIO(CS6のみ)
- CeVIO CS7とAIは64bitアプリケーションなので、32bitアプリケーションの棒読みちゃんと連携できません
- CS6の場合、SAPI5音源として（単独で？）連携できるようです


## 権利表記と謝辞
- このMODに含まれているbouyomichan_client.jsは、[@ryujimiya2361](https://twitter.com/ryujimiya2361)氏が作成した「棒読みちゃんWebSocketプラグイン」の使用例をほんの少しだけ改造したものが組み込まれています。このMODはWebSocketで棒読みちゃんにテキストデータ等を送ることができなければ成り立たちません。素晴らしいプラグインを作成された氏にこの場をお借りして感謝の意を申し上げます。


[^1]:AI音声プラットフォーム「CoeFont」とは。「CoeFont」( https://coefont.cloud )はAI音声プラットフォームです。最新のAI音声合成技術を活かし、「声」を手軽かつ表現力豊かな「フォント」のようにすることをコンセプトにしたAI音声技術です。従来では、50万円・10時間以上の収録を必要としていた音声合成を、このサービスでは500円・15分の収録で、自然な発声のできる「CoeFont(AI音声)」を作成できます。作成したCoeFontは、クラウド上で公開することができます。他のユーザーのCoeFontを利用したAI音声の作成も可能です。作成したCoeFontが利用されるたびに、CoeFontの作成者に収益として還元されます。またAPIを利用して、アプリやウェブサイトに組み込むこともできます。（株式会社CoeFontより）